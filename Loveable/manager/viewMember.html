<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Members</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: #f8f9fc;
      }

      .sidebar {
        width: 220px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        background-color: #0d1321;
        color: #fff;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1.5rem 1rem;
      }

      .nav-section {
        display: flex;
        flex-direction: column;
      }

      .sidebar h5 {
        padding-left: 10px;
        font-weight: 500;
        font-size: 1.5rem; /* similar to h2 size */
        margin-bottom: 1rem;
        padding-top: 30px;
        padding-bottom: 35px;
        color: #fff;
        border-bottom: 2px solid #1c2232; /* border separator */
      }

      .sidebar a {
        display: block;
        color: #ccc;
        padding: 0.6rem 1rem;
        text-decoration: none;
        margin-bottom: 0.4rem;
        border-radius: 6px;
      }

      .sidebar a:hover,
      .sidebar a.active {
        background-color: #1c2232;
        color: #fff;
      }

      .logout-btn {
        text-align: center;
      }

      .main-content {
        margin-left: 220px;
        padding: 2rem;
      }

      .table-container {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .table th {
        background-color: #f1f1f1;
      }

      /* Better spacing for table cells */
      .table td,
      .table th {
        padding: 14px 16px; /* increase vertical & horizontal padding */
        vertical-align: middle;
      }

      /* Name column alignment */
      .member-name {
        display: flex;
        align-items: center;
        gap: 12px; /* spacing between circle and name */
        font-size: 1rem;
      }

      /* Initial circle styling */
      .initial-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #e0e7ff;
        color: #1e40af;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
      }

      /* Action buttons spacing */
      td button {
        margin-right: 6px; /* spacing between buttons */
        border-radius: 6px;
      }

      .initial-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background-color: #e0e7ff;
        color: #1e40af;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 10px;
      }

      .member-name {
        display: flex;
        align-items: center;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .btn-primary {
        background-color: #3b82f6;
        border: none;
      }

      .form-control::placeholder {
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="nav-section">
        <h5>Manager Panel</h5>
        <a href="admin.html">Dashboard</a>
        <a href="#" class="active">View Members</a>
        <a href="addMember.html">Add Member</a>
      </div>
      <div class="logout-btn">
        <a href="#" onclick="logout()" class="text-danger">Logout</a>
      </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
      <div class="top-bar">
        <div>
          <h2 class="fw-bold mb-0">Contacts</h2>
          <p class="text-muted">Manage and view all your contacts</p>
        </div>
        <a href="addMember.html" class="btn btn-primary">+ Add Contact</a>
      </div>

      <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">All Contacts (<span id="memberCount">0</span>)</h5>
          <input
            type="text"
            id="searchInput"
            class="form-control w-25"
            placeholder="Search contacts..."
          />
        </div>

        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th class="text-muted">Name</th>
                <th class="text-muted">Phone</th>
                <th class="text-muted">Aadhaar</th>
                <th class="text-muted">Actions</th>
              </tr>
            </thead>

            <tbody id="membersTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Edit Member Modal -->
    <div
      class="modal fade"
      id="editMemberModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Member</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editMemberForm">
              <div class="mb-3">
                <label class="form-label">Name</label>
                <input
                  type="text"
                  id="editName"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Surname</label>
                <input
                  type="text"
                  id="editSurname"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Number</label>
                <input
                  type="text"
                  id="editNumber"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Aadhar</label>
                <input
                  type="text"
                  id="editAadhar"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Address</label>
                <textarea
                  id="editAddress"
                  class="form-control"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">T-shirt Size</label>
                <input
                  type="text"
                  id="editTshirt"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Shorts Size</label>
                <input
                  type="text"
                  id="editShorts"
                  class="form-control"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary">
                Save Changes
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentRow = null;

      document.querySelectorAll(".edit-btn").forEach((button) => {
        button.addEventListener("click", function () {
          currentRow = this.closest("tr"); // find the row
          let cells = currentRow.querySelectorAll("td");

          // Fill modal fields with row data
          document.getElementById("editName").value = cells[0].innerText;
          document.getElementById("editSurname").value = cells[1].innerText;
          document.getElementById("editNumber").value = cells[2].innerText;
          document.getElementById("editAadhar").value = cells[3].innerText;
          document.getElementById("editAddress").value = cells[4].innerText;
          document.getElementById("editTshirt").value = cells[5].innerText;
          document.getElementById("editShorts").value = cells[6].innerText;

          // Show modal
          let modal = new bootstrap.Modal(
            document.getElementById("editMemberModal")
          );
          modal.show();
        });
      });

      // Save changes back to table
      document
        .getElementById("editMemberForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          if (currentRow) {
            let cells = currentRow.querySelectorAll("td");
            cells[0].innerText = document.getElementById("editName").value;
            cells[1].innerText = document.getElementById("editSurname").value;
            cells[2].innerText = document.getElementById("editNumber").value;
            cells[3].innerText = document.getElementById("editAadhar").value;
            cells[4].innerText = document.getElementById("editAddress").value;
            cells[5].innerText = document.getElementById("editTshirt").value;
            cells[6].innerText = document.getElementById("editShorts").value;

            // Hide modal
            bootstrap.Modal.getInstance(
              document.getElementById("editMemberModal")
            ).hide();
          }
        });
    </script>

    <script>
      function logout() {
        localStorage.removeItem("isAdmin");
        window.location.href = "../index.html";
      }

      function getInitials(name = "") {
        const names = name.trim().split(" ");
        return (
          names[0]?.charAt(0).toUpperCase() +
          (names[1]?.charAt(0).toUpperCase() || "")
        );
      }

      function renderMembers(members) {
        const tbody = document.getElementById("membersTableBody");
        tbody.innerHTML = "";

        members.forEach((member, index) => {
          const fullName = `${member.firstName} ${member.lastName}`;
          const initials = getInitials(fullName);

          const row = document.createElement("tr");
          row.innerHTML = `
      <td>
        <div class="member-name">
          <div class="initial-circle">${initials}</div>
          ${fullName}
        </div>
      </td>
      <td>${member.phone || ""}</td>
      <td>${member.aadhar || ""}</td>
      <td>
        <button class="btn btn-sm  text-primary" onclick="viewMember(${index})" title="View">
          <i class="bi bi-eye"></i>
        </button>
        <button class="btn btn-sm text-success edit-btn action-btn" onclick="editMember(${index})" title="Edit">
  <i class="bi bi-pencil"></i>
</button>

        <button class="btn btn-sm  text-danger" onclick="deleteMember(${index})" title="Delete">
          <i class="bi bi-trash"></i>
        </button>
      </td>
    `;
          tbody.appendChild(row);
        });

        document.getElementById("memberCount").innerText = members.length;
      }

      function loadAndRenderMembers() {
        const members = JSON.parse(localStorage.getItem("members") || "[]");
        window.allMembers = members;
        renderMembers(members);

        document
          .getElementById("searchInput")
          .addEventListener("input", function () {
            const searchTerm = this.value.toLowerCase();
            const filtered = allMembers.filter((m) =>
              `${m.firstName} ${m.lastName} ${m.email} ${m.phone} ${m.address}`
                .toLowerCase()
                .includes(searchTerm)
            );
            renderMembers(filtered);
          });
      }

      function viewMember(index) {
        const member = allMembers[index];
        alert(
          `Full Name: ${member.firstName} ${member.lastName}\nEmail: ${member.email}\nPhone: ${member.phone}\nAddress: ${member.address}`
        );
      }

      function editMember(index) {
        const member = allMembers[index];
        const updatedName = prompt(
          "Edit full name",
          `${member.firstName} ${member.lastName}`
        );
        if (updatedName) {
          const [firstName, lastName] = updatedName.split(" ");
          allMembers[index].firstName = firstName || "";
          allMembers[index].lastName = lastName || "";
          localStorage.setItem("members", JSON.stringify(allMembers));
          loadAndRenderMembers();
        }
      }

      function deleteMember(index) {
        if (confirm("Are you sure you want to delete this member?")) {
          allMembers.splice(index, 1);
          localStorage.setItem("members", JSON.stringify(allMembers));
          loadAndRenderMembers();
        }
      }

      loadAndRenderMembers();
    </script>
    \
    <script>
      let members = JSON.parse(localStorage.getItem("members")) || [];

      // Called when clicking pencil icon
      function editMember(index) {
        let member = members[index];

        // Store index in hidden field
        document.getElementById("editIndex").value = index;

        // Fill modal inputs
        document.getElementById("editName").value = member.name;
        document.getElementById("editSurname").value = member.surname;
        document.getElementById("editNumber").value = member.number;
        document.getElementById("editAadhar").value = member.aadhar;
        document.getElementById("editAddress").value = member.address;
        document.getElementById("editTshirt").value = member.tshirt;
        document.getElementById("editShorts").value = member.shorts;

        // Show modal
        let modal = new bootstrap.Modal(
          document.getElementById("editMemberModal")
        );
        modal.show();
      }

      // Handle Save Changes
      document
        .getElementById("editMemberForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          let index = document.getElementById("editIndex").value;

          // Update member object
          members[index] = {
            name: document.getElementById("editName").value,
            surname: document.getElementById("editSurname").value,
            number: document.getElementById("editNumber").value,
            aadhar: document.getElementById("editAadhar").value,
            address: document.getElementById("editAddress").value,
            tshirt: document.getElementById("editTshirt").value,
            shorts: document.getElementById("editShorts").value,
          };

          // Save back to localStorage
          localStorage.setItem("members", JSON.stringify(members));

          // Refresh table
          renderMembers();

          // Hide modal
          bootstrap.Modal.getInstance(
            document.getElementById("editMemberModal")
          ).hide();
        });
    </script>
  </body>
</html>
