<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Members</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f9fc;
      }

      .sidebar {
        width: 220px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        background-color: #0d1321;
        color: #fff;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1.5rem 1rem;
      }

      .nav-section {
        display: flex;
        flex-direction: column;
      }

      .sidebar h5 {
        padding-left: 10px;
        font-weight: 500;
        font-size: 1.5rem; /* similar to h2 size */
        margin-bottom: 1rem;
        padding-top: 30px;
        padding-bottom: 35px;
        color: #fff;
        border-bottom: 2px solid #1c2232; /* border separator */
      }

      .sidebar a {
        display: block;
        color: #ccc;
        padding: 0.6rem 1rem;
        text-decoration: none;
        margin-bottom: 0.4rem;
        border-radius: 6px;
      }

      .sidebar a:hover,
      .sidebar a.active {
        background-color: #1c2232;
        color: #fff;
      }

      .logout-btn {
        text-align: center;
      }

      .main-content {
        margin-left: 220px;
        padding: 2rem;
      }

      .table-container {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .table th {
        background-color: #f1f1f1;
      }

      /* Better spacing for table cells */
      .table td,
      .table th {
        padding: 14px 16px; /* increase vertical & horizontal padding */
        vertical-align: middle;
      }

      /* Name column alignment */
      .member-name {
        display: flex;
        align-items: center;
        gap: 12px; /* spacing between circle and name */
        font-size: 1rem;
      }

      /* Initial circle styling */
      .initial-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #e0e7ff;
        color: #1e40af;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
      }

      /* Action buttons spacing */
      td button {
        margin-right: 6px; /* spacing between buttons */
        border-radius: 6px;
      }

      .initial-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background-color: #e0e7ff;
        color: #1e40af;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 10px;
      }

      .member-name {
        display: flex;
        align-items: center;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .btn-primary {
        background-color: #3b82f6;
        border: none;
      }

      .form-control::placeholder {
        font-size: 0.9rem;
      }

      .actions button i {
        color: grey;
      }

      .bi-eye:hover {
        color: #3b82f6;
      }
      .bi-pencil:hover {
        color: green;
      }
      .bi-trash:hover {
        color: red;
      }

      .page-circle {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: 1px solid #dcdcdc;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        cursor: pointer;
        transition: 0.2s;
      }

      .page-circle:hover {
        background: #f3f3f3;
      }

      .active-page {
        background: #4da6ff !important;
        color: white !important;
        border: none !important;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="nav-section">
        <h5>Manager Panel</h5>
        <a href="manager.html">
          <i class="bi bi-speedometer2 me-2"></i> Dashboard</a
        >
        <a href="viewMember.html" class="active">
          <i class="bi bi-people me-2"></i>View Members</a
        >
        <a href="addMember.html">
          <i class="bi bi-person-plus me-2"></i>Add Member</a
        >
      </div>
      <div class="logout-btn">
        <a href="#" onclick="logout()" class="text-danger">Logout</a>
      </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
      <div class="top-bar">
        <div>
          <h2 class="fw-bold mb-0">Contacts</h2>
          <p class="text-muted">Manage and view all your contacts</p>
        </div>
        <a href="addMember.html" class="btn btn-primary"
          ><i class="bi bi-person-plus me-2"></i> Add Contact</a
        >
      </div>

      <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">All Contacts (<span id="memberCount">0</span>)</h5>
          <input
            type="text"
            id="searchInput"
            class="form-control w-25"
            placeholder="Search contacts..."
          />
        </div>

        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th class="text-muted">Name</th>
                <th class="text-muted">Phone</th>
                <th class="text-muted">Aadhaar</th>
                <th class="text-muted">Actions</th>
              </tr>
            </thead>

            <tbody id="membersTableBody"></tbody>
          </table>
          <div id="pagination" class="mt-3"></div>
        </div>
      </div>
    </div>

    <script>
      // Save changes back to table
      document
        .getElementById('editMemberForm')
        .addEventListener('submit', function (e) {
          e.preventDefault()
          if (currentRow) {
            let cells = currentRow.querySelectorAll('td')
            cells[0].innerText = document.getElementById('editName').value
            cells[1].innerText = document.getElementById('editSurname').value
            cells[2].innerText = document.getElementById('editNumber').value
            cells[3].innerText = document.getElementById('editAadhar').value
            cells[4].innerText = document.getElementById('editAddress').value
            cells[5].innerText = document.getElementById('editTshirt').value
            cells[6].innerText = document.getElementById('editShorts').value

            // Hide modal
            bootstrap.Modal.getInstance(
              document.getElementById('editMemberModal')
            ).hide()
          }
        })
    </script>

    <script>
      let currentPage = 1
      const itemsPerPage = 10
      let allMembers = []

      function logout() {
        localStorage.removeItem('isAdmin')
        window.location.href = '../index.html'
      }

      function getInitials(name = '') {
        const names = name.trim().split(' ')
        return (
          names[0]?.charAt(0).toUpperCase() +
          (names[1]?.charAt(0).toUpperCase() || '')
        )
      }

      function renderMembers(members) {
        const tbody = document.getElementById('membersTableBody')
        tbody.innerHTML = ''

        // Pagination slice
        const start = (currentPage - 1) * itemsPerPage
        const paginatedMembers = members.slice(start, start + itemsPerPage)

        paginatedMembers.forEach((member, index) => {
          const fullName = `${member.firstName} ${member.lastName}`
          const initials = getInitials(fullName)

          const row = document.createElement('tr')
          row.innerHTML = `
        <td>
          <div class="member-name">
            <div class="initial-circle">${initials}</div>
            ${fullName}
          </div>
        </td>
        <td>${member.phone || ''}</td>
        <td>${member.aadhar || ''}</td>
        <td class="actions">
          <button class="btn btn-sm text-muted" onclick="openDetails(${
            start + index
          })" title="View">
            <i class="bi bi-eye"></i>
          </button>
          <button class="btn btn-sm text-muted" onclick="editMember(${
            start + index
          })" title="Edit">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm text-muted" onclick="deleteMember(${
            start + index
          })" title="Delete">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `
          tbody.appendChild(row)
        })

        document.getElementById('memberCount').innerText = members.length
        renderPagination(members)
      }

      function renderPagination(members) {
        const totalPages = Math.ceil(members.length / itemsPerPage)
        const pagination = document.getElementById('pagination')
        pagination.innerHTML = ''

        if (totalPages <= 1) return

        const wrapper = document.createElement('div')
        wrapper.style.display = 'flex'
        wrapper.style.gap = '10px'
        wrapper.style.justifyContent = 'flex-start'
        wrapper.style.marginTop = '20px'

        // Arrow: Previous
        const prev = document.createElement('div')
        prev.innerHTML = `<i class="bi bi-chevron-left"></i>`
        prev.className = 'page-circle'
        prev.style.cursor = currentPage > 1 ? 'pointer' : 'not-allowed'
        prev.onclick = () => {
          if (currentPage > 1) {
            currentPage--
            renderMembers(allMembers)
          }
        }
        wrapper.appendChild(prev)

        // Numbered page circles
        for (let i = 1; i <= totalPages; i++) {
          const circle = document.createElement('button')
          circle.innerText = i
          circle.className = 'page-circle'

          if (i === currentPage) {
            circle.classList.add('active-page')
          }

          circle.onclick = () => {
            currentPage = i
            renderMembers(allMembers)
          }
          wrapper.appendChild(circle)
        }

        // Arrow: Next
        const next = document.createElement('div')
        next.innerHTML = `<i class="bi bi-chevron-right"></i>`
        next.className = 'page-circle'
        next.style.cursor = currentPage < totalPages ? 'pointer' : 'not-allowed'
        next.onclick = () => {
          if (currentPage < totalPages) {
            currentPage++
            renderMembers(allMembers)
          }
        }
        wrapper.appendChild(next)

        pagination.appendChild(wrapper)
      }

      function loadAndRenderMembers() {
        allMembers = JSON.parse(localStorage.getItem('members') || '[]')
        renderMembers(allMembers)

        document
          .getElementById('searchInput')
          .addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase()
            const filtered = allMembers.filter(m =>
              `${m.firstName} ${m.lastName} ${m.email} ${m.phone} ${m.address}`
                .toLowerCase()
                .includes(searchTerm)
            )
            currentPage = 1 // reset to first page after search
            renderMembers(filtered)
          })
      }

      function openDetails(index) {
        window.location.href = `viewMemberDetails.html?id=${index}`
      }

      function editMember(index) {
        window.location.href = `addMember.html?edit=${index}`
      }

      function deleteMember(index) {
        if (confirm('Are you sure you want to delete this member?')) {
          allMembers.splice(index, 1)
          localStorage.setItem('members', JSON.stringify(allMembers))
          renderMembers(allMembers)
        }
      }

      loadAndRenderMembers()
    </script>
  </body>
</html>
