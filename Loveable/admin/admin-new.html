<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin-Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f9fc;
      }
      .sidebar {
        width: 220px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        background-color: #0d1321;
        color: #fff;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1.5rem 1rem;
      }
      .nav-section {
        display: flex;
        flex-direction: column;
      }
      .sidebar h5 {
        padding-left: 10px;
        font-weight: 500;
        font-size: 1.5rem; /* similar to h2 size */
        margin-bottom: 1rem;
        padding-top: 30px;
        padding-bottom: 35px;
        color: #fff;
        border-bottom: 2px solid #1c2232; /* border separator */
      }

      .sidebar a {
        display: block;
        color: #ccc;
        padding: 0.6rem 1rem;
        text-decoration: none;
        margin-bottom: 0.4rem;
        border-radius: 6px;
      }
      .sidebar a:hover,
      .sidebar a.active {
        color: #fff;
        background-color: #1c2232;
      }
      .logout-btn {
        text-align: center;
      }
      .main-content {
        margin-left: 220px;
        padding: 2rem;
      }
      .card-box {
        border-radius: 12px;
        background: #fff;
        padding: 1.5rem;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
        height: 100%;
      }
      .btn-primary {
        background-color: #3b82f6;
        border: none;
        border-radius: 8px;
        padding: 0.6rem 1.2rem;
      }
      .recent-item {
        background-color: #f3f4f6;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
      }
      .recent-item small {
        color: #6b7280;
      }
      canvas {
        max-height: 300px;
      }
      .text-purple {
        color: #7c3bed;
      }
      .card-box {
        border-radius: 12px;
        background: #fff;
        padding: 1.5rem;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
        height: 100%;
        transition: box-shadow 0.3s ease; /* smooth shadow transition */
      }

      .card-box:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15); /* deeper shadow */
      }

      .card-box h5 i {
        color: #0a60eb;
      }

      .contact-icon i {
        color: #2bab2b !important;
      }
      .recent-contact {
        display: flex;
        justify-content: space-between;
        align-items: center; /* ensures name & icon are vertically centered */
        background: #f9fafb;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.6rem;
        transition: background 0.2s ease;
      }

      .recent-contact:hover {
        background: #f1f5f9;
      }

      .contact-name {
        font-size: 0.95rem;
        font-weight: 500; /* medium, not too bold */
        color: #111827;
      }

      .view-btn {
        background: none;
        border: none;
        color: #6b7280;
        cursor: pointer;
        font-size: 1.2rem;
        transition: color 0.2s ease;
        display: flex;
        align-items: center; /* centers the eye icon vertically */
      }

      .view-btn:hover {
        color: #111827;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="nav-section">
        <h5>Admin Panel</h5>
        <a href="manager.html" class="active">
          <i class="bi bi-speedometer2 me-2"></i> Dashboard</a
        >
        <a href="viewMember.html">
          <i class="bi bi-plus-circle me-2"></i>Add Transaction</a
        >
        <a href="addMember.html">
          <i class="bi bi-bar-chart-line me-2"></i>Reports</a
        >
      </div>
      <div class="logout-btn">
        <a href="#" onclick="logout()" class="text-danger">Logout</a>
      </div>
    </div>

    <div class="main-content">
      <h2 class="fw-bold">Dashboard</h2>
      <p class="text-muted">
        Welcome back! Here's what's happening with your admin panel.
      </p>

      <div class="row g-3 mb-4">
        <!-- Total Contacts -->
        <div class="col-md-3">
          <div
            class="card-box d-flex justify-content-between align-items-center"
          >
            <div>
              <p class="text-muted mb-1">Total Contacts</p>
              <h3 id="totalCount">0</h3>
              <small class="text-success">+12% from last month</small>
            </div>
            <div
              class="rounded-circle d-flex justify-content-center align-items-center"
              style="width: 45px; height: 45px; background-color: #e0edff"
            >
              <i class="bi bi-people fs-4 text-primary"></i>
            </div>
          </div>
        </div>

        <!-- New This Month -->
        <div class="col-md-3">
          <div
            class="card-box d-flex justify-content-between align-items-center"
          > 
            <div>
              <p class="text-muted mb-1">New This Month</p>
              <h3 id="newThisMonth">0</h3>
              <small class="text-success">+5% from last month</small>
            </div>
            <div
              class="rounded-circle d-flex justify-content-center align-items-center"
              style="width: 45px; height: 45px; background-color: #d9fce5"
            >
              <i class="bi bi-person-plus fs-4 text-success"></i>
            </div>
          </div>
        </div>

        <!-- Recently Viewed -->
        <div class="col-md-3">
          <div
            class="card-box d-flex justify-content-between align-items-center"
          >
            <div>
              <p class="text-muted mb-1">Recently Viewed</p>
              <h3 id="recentCount">0</h3>
              <small class="text-success">+8% from last month</small>
            </div>
            <div
              class="rounded-circle d-flex justify-content-center align-items-center"
              style="width: 45px; height: 45px; background-color: #f0e9ff"
            >
              <i class="bi bi-eye fs-4 text-purple"></i>
            </div>
          </div>
        </div>

        <!-- Growth Rate -->
        <div class="col-md-3">
          <div
            class="card-box d-flex justify-content-between align-items-center"
          >
            <div>
              <p class="text-muted mb-1">Growth Rate</p>
              <h3>23%</h3>
              <small class="text-success">+2% from last month</small>
            </div>
            <div
              class="rounded-circle d-flex justify-content-center align-items-center"
              style="width: 45px; height: 45px; background-color: #fff3e0"
            >
              <i class="bi bi-graph-up-arrow fs-4 text-warning"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <div class="card-box">
            <h5>Bar Chart: Contacts by Month</h5>
            <canvas id="barChart"></canvas>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card-box">
            <h5>Pie Chart: New vs Old</h5>
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="card-box">
            <h5><i class="bi bi-person-plus me-2"></i>Quick Actions</h5>
            <a href="addMember.html" class="btn btn-primary w-100 mb-2"
              >Add New Transaction</a
            >
            <a href="viewMember.html" class="btn btn-outline-secondary w-100"
              >View All Reports</a
            >
          </div>
        </div>
        <div class="col-md-6">
          <div class="card-box">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-people text-success me-2"></i> Recent Contacts
            </h5>
            <div id="recentContacts"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function logout() {
        localStorage.removeItem('isAdmin')
        window.location.href = '../index.html'
      }

      const members = JSON.parse(localStorage.getItem('members') || '[]')

      document.getElementById('totalCount').innerText = members.length

      const now = new Date()
      const currentMonth = now.getMonth()
      const currentYear = now.getFullYear()

      let newThisMonth = 0
      let recentCount = 0
      let monthlyCounts = Array(12).fill(0)

      members.forEach(member => {
        const createdAt = new Date(
          member.createdAt || member.timestamp || Date.now()
        )
        if (
          createdAt.getMonth() === currentMonth &&
          createdAt.getFullYear() === currentYear
        ) {
          newThisMonth++
        }
        if ((now - createdAt) / (1000 * 60 * 60 * 24) <= 7) {
          recentCount++
        }
        monthlyCounts[createdAt.getMonth()]++
      })

      document.getElementById('newThisMonth').innerText = newThisMonth
      document.getElementById('recentCount').innerText = recentCount

      const recentEl = document.getElementById('recentContacts')
      const recent = members.slice(-4).reverse()

      if (recent.length === 0) {
        recentEl.innerHTML = "<p class='text-muted'>No recent contacts.</p>"
      } else {
        recent.forEach(u => {
          const div = document.createElement('div')
          div.className = 'recent-contact'
          div.innerHTML = `
    <span class="contact-name">${u.firstName} ${u.lastName}</span>
    <button class="view-btn" onclick="window.location.href='viewmemberdetails.html?id=${members.indexOf(
      u
    )}'">
      <i class="bi bi-eye"></i>
    </button>
  `

          recentEl.appendChild(div)
        })
      }

      // Chart.js
      const monthLabels = [
        'Jan',
        'Feb',
        'Mar',
        'Apr',
        'May',
        'Jun',
        'Jul',
        'Aug',
        'Sep',
        'Oct',
        'Nov',
        'Dec'
      ]

      new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: monthLabels,
          datasets: [
            {
              label: 'Contacts per Month',
              data: monthlyCounts,
              backgroundColor: '#3b82f6'
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      })

      new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels: ['New This Month', 'Existing'],
          datasets: [
            {
              data: [newThisMonth, members.length - newThisMonth],
              backgroundColor: ['#10b981', '#d1d5db']
            }
          ]
        },
        options: {
          responsive: true
        }
      })
    </script>
  </body>
</html>
